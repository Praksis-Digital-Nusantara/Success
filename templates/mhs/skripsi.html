{% extends "mhs/base.html" %}

{% block content1 %}
<div class="dashboard-content">
		<!-- Enhanced Header Section -->
		<div class="skripsi-header">
			<div class="header-content">
				<div class="header-icon">
						<div class="student-photo-placeholder">
							<i class="ri-user-line"></i>
						</div>
				</div>
				<div class="header-text">
					<h1>Alur Pengajuan Skripsi</h1>
					<p>Ikuti tahapan yang telah ditentukan untuk menyelesaikan proses pengajuan skripsi</p>
				</div>
			</div>
		</div>

		<!-- Enhanced Timeline Container -->
		<div class="timeline-container">
			<div class="timeline">
				<!-- Tahap 1: Pengajuan Judul -->
				<div class="timeline-item">
					<div class="timeline-marker">
						<div class="timeline-dot"></div>
						<div class="timeline-line"></div>
					</div>
					<div class="timeline-content">
						<div class="timeline-header">
							<div class="timeline-badge">Tahap 1</div>
							<h3>Pengajuan Judul</h3>
						</div>
						
						{% if skripsi is None %}
							<div class="timeline-body">
								<div class="timeline-description">
									<p>Silahkan mengajukan judul dengan mengikuti panduan, isi form berikut untuk pengecekan judul!</p>
								</div>
								<div class="timeline-actions">
									<a href="{% url 'acd:skripsi_pjudul' %}" class="action-btn primary">
										<i class="ri-file-add-line"></i>
										Form Pengajuan Judul
									</a>
									<a href="{% url 'acd:layanan_add' %}" class="action-btn primary">
										<i class="ri-customer-service-line"></i>
										Layanan Akademik
									</a>
								</div>
							</div>
							<div class="timeline-status pending">
								<i class="ri-time-line"></i>
								<span>Menunggu Pengajuan</span>
							</div>
						{% elif skripsi.status == 'Waiting' %}
							<div class="timeline-body">
								<div class="timeline-description">
									<p>Judul Anda sedang dalam proses pengecekan oleh penasehat akademik.</p>
								</div>
								<div class="timeline-actions">
									<a href="{% url 'acd:skripsi_pjudul' %}" class="action-btn primary">
										<i class="ri-file-add-line"></i>
										Form Pengajuan Judul
									</a>
									<a target="_blank" href="{% url 'acd:print_persetujuan_judul' skripsi.id %}" class="action-btn success">
										<i class="ri-printer-line"></i>
										Cetak Rekomendasi Pengajuan Judul
									</a>
									<a href="{% url 'acd:layanan_add' %}" class="action-btn primary">
										<i class="ri-customer-service-line"></i>
										Layanan Akademik
									</a>
								</div>
							</div>
							<div class="timeline-status active">
								<i class="ri-loader-4-line"></i>
								<span>{{ skripsi.status }}</span>
							</div>
						{% else %}
							<div class="timeline-body">
								<div class="timeline-description">
									<p>Judul Anda telah disetujui oleh penasehat akademik:</p>
									<div class="approved-title">
										<i class="ri-check-double-line"></i>
										<span>"{{ skripsi.judul }}"</span>
									</div>
								</div>

								<div class="timeline-status completed">
								<i class="ri-check-line"></i>
								<span>{{ skripsi.status }}</span>
							</div>
							</div>
						
							

								
						{% endif %}
					</div>
				</div>

				<div class="timeline-item">
				<div class="timeline-marker">
					<div class="timeline-dot"></div>
					<div class="timeline-line"></div>
				</div>
				<div class="timeline-content">
					<div class="timeline-header">
						<div class="timeline-badge">Tahap 2</div>
						<h3>Penentuan Pembimbing</h3>
					</div>
					
					{% if skripsi is None %}
						<div class="timeline-body">
							<div class="timeline-description">
								<p>Penentuan dosen pembimbing skripsi oleh Program Studi.</p>
							</div>
						</div>
						<div class="timeline-status pending">
							<i class="ri-time-line"></i>
							<span>Menunggu Tahap 1</span>
						</div>
					{% elif not skripsi.pembimbing1 or not skripsi.pembimbing2 or skripsi.kajur_persetujuan == 'Waiting' or skripsi.kaprodi_persetujuan == 'Waiting' %}
						<div class="timeline-body">
							<div class="timeline-description">
								<p>Judul sedang diverifikasi. Menunggu penetapan pembimbing oleh Pimpinan Prodi dan Jurusan.</p>
							</div>
						</div>
						<div class="timeline-status active">
							<i class="ri-loader-4-line"></i>
							<span>Proses Penetapan</span>
						</div>

					{% else %}
						<div class="timeline-body">
							<div class="timeline-description">
								<p>Pembimbing telah ditetapkan:</p>
								<div class="supervisor-list">
									<div class="supervisor-item">
										<i class="ri-user-star-line"></i>
										<span>{{ skripsi.pembimbing1.nip.first_name }} </span>
									</div>
									<div class="supervisor-item">
										<i class="ri-user-star-line"></i>
										<span>{{ skripsi.pembimbing2.nip.first_name }}</span>
									</div>
								</div>
							</div>
								<a target="_blank" href="{% url 'acd:print_persetujuan_judul' skripsi.id %}" class="action-btn success">
											<i class="ri-printer-line"></i>
											Cetak Rekomendasi Pengajuan Judul
										</a>
						
						</div>

									

						<div class="timeline-status completed">
							<i class="ri-check-line"></i>
							<span>Selesai</span>
						</div>
					{% endif %}
				</div>
			</div>
				<!-- Tahap 3: Penerbitan SK Pembimbing -->
				<div class="timeline-item">
					<div class="timeline-marker">
						<div class="timeline-dot"></div>
						<div class="timeline-line"></div>
					</div>
					<div class="timeline-content">
						<div class="timeline-header">
							<div class="timeline-badge">Tahap 3</div>
							<h3>Penerbitan SK Pembimbing</h3>
						</div>
						
						{% if skripsi.status_sk is None %}
							<div class="timeline-body">
								<div class="timeline-description">
									<p>Anda belum mengajukan layanan Penerbitan SK Pembimbing, cek di Tahap 1</p>
								</div>
							</div>
							<div class="timeline-status active">
								<i class="ri-time-line"></i>
								<span>Belum Mengajukan</span>
							</div>
						{% elif skripsi.status_sk == 'Pengajuan' %}
							<div class="timeline-body">
								<div class="timeline-description">
									<p>Prodi telah mengajukan penerbitan SK ke Fakultas, silahkan tunggu</p>
								</div>
							</div>
							<div class="timeline-status active">
								<i class="ri-loader-4-line"></i>
								<span>Proses Penerbitan SK</span>
							</div>
						{% else %}
							<div class="timeline-body">
								<div class="timeline-description">
									<p>SK Pembimbing akan diajukan ke Fakultas untuk disetujui, mohon ditunggu!</p>
									<div class="sk-list">
										{% for skpbb_data in skpbb %}
										<a target='_blank' href="{% url 'acd:print_skpbb' skpbb_data.id %}" class="sk-item">
											<i class="ri-file-text-line"></i>
											<span>Download {{ skpbb_data.date_in }}</span>
										</a>
										{% endfor %}
									</div>
								</div>
							</div>
							<div class="timeline-status completed">
								<i class="ri-check-line"></i>
								<span>Selesai</span>
							</div>
						{% endif %}
					</div>
				</div>

				<!-- Tahap 4: Seminar Proposal -->
				<div class="timeline-item">
					<div class="timeline-marker">
						<div class="timeline-dot"></div>
						<div class="timeline-line"></div>
					</div>
					<div class="timeline-content">
						<div class="timeline-header">
							<div class="timeline-badge">Tahap 4</div>
							<h3>Seminar Proposal</h3>
						</div>
						
						{% if proposal.seminar_tgl is None %}
							<div class="timeline-body">
								<div class="timeline-description">
									<p>Buat proposal penelitian dan konsultasikan ke Pembimbing, berikut adalah format pengesahan proposal</p>
								</div>
								<div class="timeline-actions">
									{% if skripsi is None %}
										<div class="warning-message">
											<i class="ri-error-warning-line"></i>
											<span>Ajukan Judul Terlebih Dahulu! Lihat di Tahap 1</span>
										</div>
									{% elif not skripsi.pembimbing1 %}
										<div class="warning-message">
											<i class="ri-error-warning-line"></i>
											<span>Pembimbing 1 Belum Diset! Lihat di Tahap 2</span>
										</div>
									{% elif not skripsi.pembimbing2 %}
										<div class="warning-message">
											<i class="ri-error-warning-line"></i>
											<span>Pembimbing 2 Belum Diset! Lihat di Tahap 2</span>
										</div>
									{% else %}
										<a target="_blank" href="{% url 'acd:print_pengesahan' 'proposal' skripsi.id %}" class="action-btn success">
											<i class="ri-printer-line"></i>
											Cetak Lembar Pengesahan
										</a>
										<a href="{% url 'acd:proposal_reg' %}" class="action-btn primary">
											<i class="ri-file-add-line"></i>
											Registrasi Proposal
										</a>
									{% endif %}
								</div>
							</div>
							<div class="timeline-status active">
								<i class="ri-time-line"></i>
								<span>In Progress</span>
							</div>
						{% else %}
							<div class="timeline-body">
								<div class="timeline-description">
									<div class="notification-time">
										<i class="ri-calendar-line"></i>
										<span>{{ proposal.seminar_tgl }}</span>
									</div>
									<p>Undangan seminar proposal penelitian Anda telah terbit, silahkan download di tautan berikut:</p>
								</div>
								<div class="timeline-actions">
									<a target="_blank" href="{% url 'acd:print_undangan' 'Proposal' proposal.id %}" class="action-btn success">
										<i class="ri-download-line"></i>
										Cetak Undangan
									</a>
										<a target="_blank" href="/" class="action-btn success">
											<i class="ri-printer-line"></i>
										Download Template Matriks Perbaikan
									</a>
								</div>
							</div>
							<div class="timeline-status completed">
								<i class="ri-check-line"></i>
								<span>Selesai</span>
							</div>
						{% endif %}
					</div>
				</div>

				<!-- Tahap 5: Penelitian -->
				<div class="timeline-item">
					<div class="timeline-marker">
						<div class="timeline-dot"></div>
						<div class="timeline-line"></div>
					</div>
					<div class="timeline-content">
						<div class="timeline-header">
							<div class="timeline-badge">Tahap 5</div>
							<h3>Penelitian</h3>
						</div>
						
						{% if izinpenelitian %}
							<div class="timeline-body">
								<div class="timeline-description">
									<div class="notification-time">
										<i class="ri-calendar-line"></i>
										<span>{{ proposal.seminar_tgl }}</span>
									</div>
									<p>Izin Penelitian Anda telah terbit, silahkan download di tautan berikut:</p>
								</div>
								<div class="timeline-actions">
									{% for datatb in izinpenelitian  %}
									<a target="_blank" href="{% url 'acd:print_izinpenelitian' datatb.id %}" class="action-btn success">
										<i class="ri-download-line"></i>
										Cetak Izin Penelitian
									</a>
									{% endfor %}
								</div>
							</div>
							<div class="timeline-status completed">
								<i class="ri-check-line"></i>
								<span>Selesai</span>
							</div>
						{% elif not proposal %}
							<div class="timeline-body">
								<div class="timeline-description">
									<p>Maaf Anda belum melaksanakan Proposal</p>
								</div>
							</div>
							<div class="timeline-status pending">
								<i class="ri-time-line"></i>
								<span>Menunggu Tahap 4</span>
							</div>
						{% elif not proposal.seminar_tgl %}
								<div class="timeline-body">
								<div class="timeline-description">
									<p>Lakukan revisi proposal sebelum melaksanakan penelitian.</p>
								</div>
							</div>
							<div class="timeline-status active">
								<i class="ri-time-line"></i>
								<span>In Progress</span>
							</div>
						{% else %}
						<!-- Jika proposal sudah ada dan seminar_tgl ada -->
	<div class="timeline-body">
		<div class="timeline-description">
			<p>Lembar persetujuan dan permohonan penerbitan izin penelitian tersedia:</p>
		</div>
		<div class="timeline-actions">
			<a target="_blank" href="{% url 'acd:print_persetujuan_penelitian' proposal.id %}" class="action-btn success">
				<i class="ri-printer-line"></i>
				Cetak Lembar Pengesahan Penelitian
			</a>
			<a target="_blank" href="{% url 'acd:print_permohonan_penerbitan_sip' proposal.id %}" class="action-btn success">
				<i class="ri-printer-line"></i>
				Cetak Permohonan Penerbitan Izin Penelitian
			</a>
			<a href="{% url 'acd:layanan_add' %}" class="action-btn primary">
				<i class="ri-customer-service-line"></i>
				Layanan Akademik
			</a>
		</div>
	</div>
	<div class="timeline-status active">
		<i class="ri-time-line"></i>
		<span>In Progress</span>
	</div>
{% endif %}
					</div>
				</div>

				<!-- Tahap 6: Seminar Hasil -->
				<div class="timeline-item">
					<div class="timeline-marker">
						<div class="timeline-dot"></div>
						<div class="timeline-line"></div>
					</div>
					<div class="timeline-content">
						<div class="timeline-header">
							<div class="timeline-badge">Tahap 6</div>
							<h3>Seminar Hasil</h3>
						</div>
						{% if hasil.seminar_tgl is None %}
							<div class="timeline-body">
								<div class="timeline-description">
									<p>Buat Hasil Penelitian dan konsultasikan ke Pembimbing, berikut adalah format pengesahan seminar hasil</p>
								</div>
								<div class="timeline-actions">
									{% if skripsi is None %}
										<div class="warning-message">
											<i class="ri-error-warning-line"></i>
											<span>Ajukan Judul Terlebih Dahulu! Lihat di Tahap 1</span>
										</div>
									{% elif not skripsi.pembimbing1 %}
										<div class="warning-message">
											<i class="ri-error-warning-line"></i>
											<span>Pembimbing 1 Belum Diset! Lihat di Tahap 2</span>
										</div>
									{% elif not skripsi.pembimbing2 %}
										<div class="warning-message">
											<i class="ri-error-warning-line"></i>
											<span>Pembimbing 2 Belum Diset! Lihat di Tahap 2</span>
										</div>
									{% elif not skripsi.izinpenelitian_mhsjudul.exists %}
										<div class="warning-message">
											<i class="ri-error-warning-line"></i>
											<span>Izin Penelitian Belum Terbit! Lihat di Tahap 5</span>
										</div>
									{% else %}
										<a target="_blank" href="{% url 'acd:print_pengesahan' 'hasil' skripsi.id %}" class="action-btn success">
											<i class="ri-printer-line"></i>
											Cetak Lembar Pengesahan
										</a>
										<a href="{% url 'acd:hasil_reg' %}" class="action-btn primary">
											<i class="ri-file-add-line"></i>
											Registrasi Hasil
										</a>
									{% endif %}
								</div>
							</div>
							<div class="timeline-status active">
								<i class="ri-time-line"></i>
								<span>In Progress</span>
							</div>
						{% else %}
						<div class="timeline-body">
								<div class="timeline-description">
									<div class="notification-time">
										<i class="ri-calendar-line"></i>
										<span>{{ hasil.seminar_tgl }}</span>
									</div>
									<p>Undangan seminar hasil penelitian Anda telah terbit, silahkan download di tautan berikut:</p>
								</div>
								<div class="timeline-actions">
									<a target="_blank" href="{% url 'acd:print_undangan' 'Hasil' hasil.id %}" class="action-btn success">
										<i class="ri-download-line"></i>
										Cetak Undangan
									</a>
									<a target="_blank" href="/" class="action-btn success">
											<i class="ri-printer-line"></i>
										Download Template Matriks Perbaikan
									</a>
								</div>
							</div>
							<div class="timeline-status completed">
								<i class="ri-check-line"></i>
								<span>Selesai</span>
							</div>
						{% endif %}
					</div>
				</div>

				<!-- Tahap 7: Ujian Skripsi -->
				<!-- Tahap 7: Ujian Skripsi -->
<div class="timeline-item">
    <div class="timeline-marker">
        <div class="timeline-dot"></div>
    </div>
    <div class="timeline-content">
        <div class="timeline-header">
            <div class="timeline-badge">Tahap 7</div>
            <h3>Pengusulan Ujian Tutup</h3>
        </div>

        {% if not hasil or not hasil.seminar_tgl %}
            <!-- Kalau seminar hasil belum dilaksanakan -->
            <div class="timeline-body">
                <div class="timeline-description">
                    <p>Anda belum melaksanakan Seminar Hasil, silahkan selesaikan Tahap 6 terlebih dahulu.</p>
                </div>
            </div>
            <div class="timeline-status pending">
                <i class="ri-time-line"></i>
                <span>Menunggu Tahap 6</span>
            </div>

        {% elif not ujian.wd and not ujian.dekan %}
            <!-- Kalau seminar hasil sudah ada, tapi ujian tutup belum -->
            <div class="timeline-body">
                <div class="timeline-description">
                    <p>Konsultasikan ke pembimbing untuk melaksanakan ujian tutup skripsi, berikut adalah format lembar pengesahan</p>
                </div>
                <div class="timeline-actions">
                    {% if skripsi is None %}
                        <div class="warning-message">
                            <i class="ri-error-warning-line"></i>
                            <span>Ajukan Judul Terlebih Dahulu!</span>
                        </div>
                    {% else %}
                        <a target="_blank" href="{% url 'acd:print_pengesahan' 'Ujian' skripsi.id %}" class="action-btn success">
                            <i class="ri-printer-line"></i>
                            Cetak Lembar Pengesahan
                        </a>
                        <a href="{% url 'acd:usulan_ujian_reg' %}" class="action-btn primary">
                            <i class="ri-file-add-line"></i>
                            Pengusulan Ujian Tutup
                        </a>
                    {% endif %}
                </div>
            </div>
            <div class="timeline-status active">
                <i class="ri-time-line"></i>
                <span>In Progress</span>
            </div>

        {% else %}
            <!-- Kalau ujian tutup sudah terbit -->
            <div class="timeline-body">
                <div class="timeline-description">
                    <div class="notification-time">
                        <i class="ri-calendar-line"></i>
                        <span>{{ ujian.ujian_tgl }}</span>
                    </div>
                    <p>Silahkan cetak lembar persetujuan waktu untuk di ttd masing-masing Dosen</p>
                </div>
                <div class="timeline-actions">
                    <a target="_blank" href="{% url 'acd:print_persetujuan_waktu_ujian' ujian.id %}" class="action-btn success">
                        <i class="ri-download-line"></i>
                        Cetak Persetujuan Waktu Ujian
                    </a>
                </div>
            </div>
            <div class="timeline-status completed">
                <i class="ri-check-line"></i>
                <span>Selesai</span>
            </div>
        {% endif %}
    </div>
</div>

<div class="timeline-item">
    <div class="timeline-marker">
        <div class="timeline-dot"></div>
    </div>
    <div class="timeline-content">
        <div class="timeline-header">
            <div class="timeline-badge">Tahap 8</div>
            <h3>Ujian Tutup/Ujian Skripsi</h3>
        </div>

        {% if not ujian or not ujian.wd or not ujian.dekan %}
            <!-- Kalau seminar hasil belum dilaksanakan -->
            <div class="timeline-body">
                <div class="timeline-description">
                    <p>Anda belum menyelaikan pemberkasan Pengusulan Ujian Tutup, silahkan selesaikan Tahap 7 terlebih dahulu.</p>
                </div>
            </div>
            <div class="timeline-status pending">
                <i class="ri-time-line"></i>
                <span>Menunggu Tahap 7</span>
            </div>

        {% elif not ujian.no_surat %}
            <!-- Kalau seminar hasil sudah ada, tapi ujian tutup belum -->
            <div class="timeline-body">
                <div class="timeline-description">
                    <p>Setelah mencetak lembar persetujuan waktu untuk dikonfirmasi ke masing-masing dosen, mahasiswa dapat melanjutkan tahap 8</p>
                </div>
                <div class="timeline-actions">
                    {% if skripsi is None %}
                        <div class="warning-message">
                            <i class="ri-error-warning-line"></i>
                            <span>Ajukan Judul Terlebih Dahulu!</span>
                        </div>
                    {% else %}
                        <a href="{% url 'acd:ujian_reg' %}" class="action-btn primary">
                            <i class="ri-file-add-line"></i>
                            Registrasi Ujian
                        </a>
                    {% endif %}
                </div>
            </div>
            <div class="timeline-status active">
                <i class="ri-time-line"></i>
                <span>In Progress</span>
            </div>

        {% else %}
            <!-- Kalau ujian tutup sudah terbit -->
            <div class="timeline-body">
                <div class="timeline-description">
                    <div class="notification-time">
                        <i class="ri-calendar-line"></i>
                        <span>{{ ujian.ujian_tgl }}</span>
                    </div>
                    <p>Undangan ujian tutup Anda telah terbit, silahkan download di tautan berikut:</p>
                </div>
                <div class="timeline-actions">
                    <a target="_blank" href="{% url 'acd:print_undangan_ujian' ujian.id %}" class="action-btn success">
                        <i class="ri-download-line"></i>
                        Cetak Undangan Ujian
                    </a>
                </div>
				<!-- cetak sk ujian -->
				{% if skujian.ttd %}
				<div class="timeline-actions">
					<a target="_blank" href="{% url 'acd:print_skpgj' skujian.id %}" class="action-btn success">
						<i class="ri-download-line"></i>
						Cetak SK Ujian
					</a>
				</div>
				{% else %}
				<div class="timeline-status active" style="margin-top: 5px;">
								<i class="ri-time-line"></i>
								<span>SK Ujian Belum Disetujui, Mohon menunggu!</span>
				</div>
				{% endif %}
            </div>
            <div class="timeline-status completed">
                <i class="ri-check-line"></i>
                <span>Selesai</span>
            </div>
        {% endif %}
    </div>
</div>

			</div>
		</div>
</div>
{% endblock content1 %}



