{% extends "verif_ttd/base.html" %}
{% block content %}
    <div class="container">
    <div class="card 
    {# --- LOGIKA WARNA CARD (MERAH/NORMAL) --- #}
    {% if jenis == 'skpbb' or jenis == 'skpgj' or jenis == 'upr' or jenis == 'izp' or jenis == 'sak' or jenis == 'skb' or jenis == 'scak' or jenis == 'uhs' or jenis == 'sbp' or jenis == 'sbpe' or jenis == 'suus' %}
        {% if not data.ttd or not data.ttd.pejabat %}
            card-danger
        {% endif %}
    {% elif jenis == 'puj' %}
        {# Khusus PUJ: Cek Kajur Persetujuan #}
        {% if data.kajur_persetujuan != 'Approved' and data.kajur_persetujuan != 'ACC' %}
            card-danger
        {% endif %}
    {% elif jenis == 'pgj_pa' or jenis == 'pgj_mhs' %}
        {% if not data.status %}
            card-danger
        {% endif %}
    {% endif %}">
       
       <div class="card-header 
    {# --- LOGIKA WARNA HEADER --- #}
    {% if jenis == 'skpbb' or jenis == 'skpgj' or jenis == 'upr' or jenis == 'izp' or jenis == 'sak' or jenis == 'skb' or jenis == 'scak' or jenis == 'uhs' or jenis == 'sbp' or jenis == 'sbpe' or jenis == 'suus' %}
        {% if not data.ttd or not data.ttd.pejabat %}
            card-header-danger
        {% endif %}
    {% elif jenis == 'puj' %}
        {% if data.kajur_persetujuan != 'Approved' and data.kajur_persetujuan != 'ACC' %}
            card-header-danger
        {% endif %}
    {% elif jenis == 'pgj_pa' or jenis == 'pgj_mhs' %}
        {% if not data.status %}
            card-header-danger
        {% endif %}
    {% endif %}">
                <div class="header-icon">
                    <i class="ri-shield-check-line"></i>
                </div>
                <h1 class="header-title">Verifikasi Dokumen</h1>
                
                {% if jenis == 'puj' %}
                    <p class="header-subtitle">Dokumen Digital [Persetujuan Judul]</p>
                {% elif jenis in "skpbb skpgj upr izp sak scak uhs sbp sbpe suus" %}
                    <p class="header-subtitle">Dokumen Digital [{{ title }}]</p>
                {% endif %}

                <div class="status-badge status-verified">
                    <i class="ri-checkbox-circle-fill"></i>
                    <span>
                {# --- LOGIKA STATUS TEXT --- #}
                {% if jenis in "skpbb skpgj upr izp sak skb scak uhs sbp sbpe suus" %}
                    {% if data.ttd and data.ttd.pejabat %}
                        Terverifikasi
                    {% else %}
                        Tidak Terverifikasi
                    {% endif %}
                {% elif jenis == 'puj' %}
                    {% if data.kajur_persetujuan == 'Approved' or data.kajur_persetujuan == 'ACC' %}
                        Terverifikasi
                    {% else %}
                        Belum Disetujui
                    {% endif %}
                {% elif jenis in "pgj_pa pgj_mhs" %}
                    {% if data.status %}
                        Terverifikasi
                    {% else %}
                        Tidak Terverifikasi
                    {% endif %}
                {% endif %}
                    </span>
                </div>
            </div>

            <div class="card-body">
                <div class="info-grid">
                    
                    {% if jenis in "skpbb skpgj upr izp sak skb scak uhs sbp sbpe suus puj" %}
                    <div class="info-group">
                        <div class="group-title">
                           <i class="ri-article-line"></i>
                            Detail Dokumen
                        </div>
                        
                        {# Nomor Surat tidak ada di SkripsiJudul (puj) #}
                        {% if jenis != "puj" and jenis != "upr" %} 
                        <div class="info-item">
                            <span class="info-label">Nomor Surat</span>
                            <span class="info-value">{{ data.nosurat }}{{ data.no_surat }}</span>
                        </div>
                        {% endif %}

                        <div class="info-item">
                            <span class="info-label">Nama</span>
                            <span class="info-value">
                                {% if jenis == 'puj' %}
                                    {{ data.mhs.nim.first_name }}
                                {% else %}
                                    {{ data.mhs.nim.first_name }} {{ data.proposal.mhs_judul.mhs.nim.first_name }} {{ data.mhs_judul.mhs.nim.first_name}} {{ data.usulan.mhs_judul.mhs.nim.first_name}}
                                {% endif %}
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">NIM</span>
                            <span class="info-value">
                                {% if jenis == 'puj' %}
                                    {{ data.mhs.nim.username }}
                                {% else %}
                                    {{ data.mhs.nim.username }} {{ data.proposal.mhs_judul.mhs.nim.username }} {{ data.mhs_judul.mhs.nim.username}} {{ data.usulan.mhs_judul.mhs.nim.username}}
                                {% endif %}
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Prodi</span>
                            <span class="info-value">
                                {% if jenis == 'puj' %}
                                    {{ data.mhs.prodi.nama_prodi }}
                                {% else %}
                                    {{ data.mhs.prodi.nama_prodi }} {{ data.proposal.mhs_judul.mhs.prodi.nama_prodi }} {{ data.mhs_judul.mhs.prodi.nama_prodi}} {{ data.usulan.mhs_judul.mhs.prodi.nama_prodi}}
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    {% elif jenis in "pgj_pa pgj_mhs" %}
                    <div class="info-group">
                        <div class="group-title">
                            <i class="ri-file-text-line"></i>
                            Mahasiswa
                        </div>
                        <div class="info-item">
                            <span class="info-label">Nama</span>
                            <span class="info-value">{{ data.mhs.nim.first_name }} {{ data.proposal.mhs_judul.mhs.nim.first_name }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">NIM</span>
                            <span class="info-value">{{ data.mhs.nim.username }} {{ data.proposal.mhs_judul.mhs.nim.username }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Prodi</span>
                            <span class="info-value">{{ data.mhs.prodi.nama_prodi }} {{ data.proposal.mhs_judul.mhs.prodi.nama_prodi }}</span>
                        </div>
                    </div>
                    {% endif %}


                    {% if jenis in "skpbb skpgj upr izp sak skb scak uhs sbp sbpe suus" %}
                    <div class="info-group">
                        <div class="group-title">
                            <i class="ri-user-star-line"></i>
                            Penandatangan
                        </div>
                     {% if data.ttd.pejabat %}
                    <div class="info-item">
                        <span class="info-label">Jabatan</span>
                        <span class="info-value">{{ data.ttd.jabatan }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Nama</span>
                        <span class="info-value">{{ data.ttd.pejabat.nip.first_name }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">NIP</span>
                        <span class="info-value">{{ data.ttd.pejabat.nip.username }}</span>
                    </div>
                    {% else %}
                        <div class="info-item">
                            <span class="info-label">Deskripsi:</span>
                            <span class="info-value">Membatalkan tanda tangan</span>
                        </div>
                    {% endif %}
                        <div class="info-item">
                            <span class="info-label">Status</span>
                            <span class="info-value">
                             <span class="signature-status signature-verified">
                                <i class="ri-shield-check-fill"></i>
                                {% if data.ttd.pejabat %}
                                    {% if data.ttd_status == "Manual" %}
                                        Terverifikasi Manual
                                    {% elif data.ttd_status == "QRcode" %}
                                        Terverifikasi
                                    {% endif %}
                                {% else %}
                                    Tidak Terverifikasi
                                {% endif %}
                            </span>
                            </span>
                        </div>
                    </div>

                    {# --- KHUSUS PUJ (SkripsiJudul) --- #}
                    {% elif jenis == "puj" %}
                    <div class="info-group">
                        <div class="group-title">
                            <i class="ri-user-star-line"></i>
                            Status Persetujuan
                        </div>
                        <div class="info-item">
                            <span class="info-label">Judul Disetujui</span>
                            <span class="info-value" style="font-weight: bold;">{{ data.judul|default:"Menunggu Penetapan" }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Menyetujui</span>
                            <span class="info-value">Ketua Jurusan</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Menyetujui</span>
                            <span class="info-value">Ketua Prodi</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Status Verifikasi</span>
                            <span class="info-value">
                                <span class="signature-status {% if data.kajur_persetujuan == 'Approved' or data.kajur_persetujuan == 'ACC' %}signature-verified{% else %}signature-pending{% endif %}">
                                    <i class="ri-shield-check-fill"></i>
                                    {% if data.kajur_persetujuan %}
                                        {{ data.kajur_persetujuan }}
                                    {% else %}
                                        Waiting
                                    {% endif %}
                                </span>
                            </span>
                        </div>
                    </div>

                    {% elif jenis == "pgj_pa" or jenis == "pgj_mhs" %}
                    <div class="info-group">
                        <div class="group-title">
                            <i class="ri-user-star-line"></i>
                            Status Pengajuan:
                        </div>
                        <div class="info-item">
                            <span class="info-label">Status</span>
                            <span class="info-value">
                                <span class="signature-status signature-verified">
                                    <i class="ri-shield-check-fill"></i>
                                    {{ data.status|default:"-" }}
                                </span>
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Penasehat Akademik</span>
                            <span class="info-value">{{ data.mhs.penasehat_akademik.nip.first_name}}</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="card-footer">
                <p class="footer-text">Sistem Verifikasi Digital 2025</p>
                <p class="verification-code">ID: #VRF-{{ data.id }}-2025</p>
            </div>
        </div>
    </div>
{% endblock content %}